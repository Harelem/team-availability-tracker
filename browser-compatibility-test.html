<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross-Platform Browser Compatibility Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e1e5e9;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            background: #fafbfc;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e1e5e9;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status.pass { background: #d4edda; color: #155724; }
        .status.fail { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        .status.unknown { background: #e2e3e5; color: #495057; }
        .browser-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }
        .mobile-test {
            border: 2px solid #007bff;
            background: #f0f8ff;
        }
        .accessibility-test {
            border: 2px solid #28a745;
            background: #f0fff4;
        }
        .performance-test {
            border: 2px solid #ffc107;
            background: #fffbf0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            min-height: 44px; /* Touch target */
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .iframe-container {
            margin: 20px 0;
            border: 1px solid #ccc;
            border-radius: 6px;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
        .device-selector {
            margin: 20px 0;
        }
        .device-selector select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 16px; /* Prevent zoom on iOS */
        }
        .hebrew-test {
            direction: rtl;
            text-align: right;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .test-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Cross-Platform Browser Compatibility Test</h1>
            <p>Comprehensive testing for enterprise deployment readiness</p>
        </div>

        <!-- Browser Detection -->
        <div class="browser-info">
            <h2>ğŸŒ Browser Information</h2>
            <div id="browser-details"></div>
        </div>

        <!-- Feature Detection Tests -->
        <div class="test-section">
            <h2>ğŸ”§ Feature Detection & Compatibility</h2>
            <div class="test-grid" id="feature-tests"></div>
        </div>

        <!-- Mobile Responsiveness Tests -->
        <div class="test-section mobile-test">
            <h2>ğŸ“± Mobile Responsiveness Tests</h2>
            <div class="device-selector">
                <label for="device-select">Test Device: </label>
                <select id="device-select">
                    <option value="375,667">iPhone SE (375Ã—667)</option>
                    <option value="390,844">iPhone 14 (390Ã—844)</option>
                    <option value="428,926">iPhone 14 Plus (428Ã—926)</option>
                    <option value="768,1024">iPad (768Ã—1024)</option>
                    <option value="360,640">Android Small (360Ã—640)</option>
                    <option value="411,731">Android Standard (411Ã—731)</option>
                    <option value="414,896">Android Large (414Ã—896)</option>
                </select>
                <button onclick="testMobileViewport()">Test Viewport</button>
                <button onclick="testTouchTargets()">Test Touch Targets</button>
            </div>
            <div class="test-grid" id="mobile-tests"></div>
        </div>

        <!-- Accessibility Tests -->
        <div class="test-section accessibility-test">
            <h2>â™¿ Accessibility Compliance Tests</h2>
            <button onclick="testKeyboardNavigation()">Test Keyboard Navigation</button>
            <button onclick="testColorContrast()">Test Color Contrast</button>
            <button onclick="testScreenReader()">Test Screen Reader</button>
            <div class="test-grid" id="accessibility-tests"></div>
        </div>

        <!-- Performance Tests -->
        <div class="test-section performance-test">
            <h2>âš¡ Performance Tests</h2>
            <button onclick="testLoadTime()">Test Load Time</button>
            <button onclick="testInteractivity()">Test Interactivity</button>
            <div class="test-grid" id="performance-tests"></div>
        </div>

        <!-- Hebrew Text Rendering Test -->
        <div class="test-section">
            <h2>ğŸ”¤ Hebrew Text Rendering Test</h2>
            <div class="hebrew-test">
                <h3>×‘×“×™×§×ª ×˜×§×¡×˜ ×‘×¢×‘×¨×™×ª</h3>
                <p>×–×”×• ×˜×§×¡×˜ ×œ×‘×“×™×§×ª ×ª×¦×•×’×” × ×›×•× ×” ×©×œ ×¢×‘×¨×™×ª ×‘××¤×œ×™×§×¦×™×”. ×”×˜×§×¡×˜ ×¦×¨×™×š ×œ×”×™×•×ª ××™×•×©×¨ ×œ×™××™×Ÿ ×•×œ×”×™×¨××•×ª ×‘×‘×™×¨×•×¨.</p>
                <p>Mixed text: Hello ×©×œ×•× World ×¢×•×œ× 123</p>
                <div style="direction: ltr; text-align: left; background: white; padding: 10px; margin: 10px 0;">
                    <strong>LTR Context:</strong> English text with ×¢×‘×¨×™×ª mixed in should render correctly.
                </div>
            </div>
            <button onclick="testHebrewRendering()">Test Hebrew Rendering</button>
        </div>

        <!-- Application Frame Test -->
        <div class="test-section">
            <h2>ğŸ“‹ Application Integration Test</h2>
            <p>Testing the actual application in different viewport sizes:</p>
            <div class="iframe-container">
                <iframe id="app-frame" src="http://localhost:3000" title="Team Availability Tracker"></iframe>
            </div>
            <button onclick="testAppIntegration()">Test App Features</button>
            <button onclick="toggleMobileView()">Toggle Mobile View</button>
        </div>

        <!-- Results Summary -->
        <div class="test-section">
            <h2>ğŸ“Š Test Results Summary</h2>
            <div id="results-summary"></div>
            <button onclick="generateReport()">Generate Full Report</button>
            <button onclick="exportResults()">Export Results</button>
        </div>
    </div>

    <script>
        // Global test results storage
        window.testResults = {
            browser: {},
            features: {},
            mobile: {},
            accessibility: {},
            performance: {},
            hebrew: {},
            overall: { passed: 0, failed: 0, warnings: 0 }
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            detectBrowser();
            runInitialTests();
        });

        // Browser Detection
        function detectBrowser() {
            const browserInfo = {
                userAgent: navigator.userAgent,
                vendor: navigator.vendor,
                platform: navigator.platform,
                language: navigator.language,
                languages: navigator.languages,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                viewport: {
                    width: window.innerWidth,
                    height: window.innerHeight,
                    devicePixelRatio: window.devicePixelRatio
                },
                screen: {
                    width: screen.width,
                    height: screen.height,
                    colorDepth: screen.colorDepth
                }
            };

            // Detect browser type
            let browserType = 'Unknown';
            if (browserInfo.userAgent.includes('Chrome') && !browserInfo.userAgent.includes('Edg')) {
                browserType = 'Chrome';
            } else if (browserInfo.userAgent.includes('Safari') && !browserInfo.userAgent.includes('Chrome')) {
                browserType = 'Safari';
            } else if (browserInfo.userAgent.includes('Firefox')) {
                browserType = 'Firefox';
            } else if (browserInfo.userAgent.includes('Edg')) {
                browserType = 'Edge';
            }

            const browserDetails = document.getElementById('browser-details');
            browserDetails.innerHTML = `
                <div class="test-grid">
                    <div class="test-item">
                        <strong>Browser:</strong> ${browserType}<br>
                        <strong>Version:</strong> ${getBrowserVersion(browserInfo.userAgent)}<br>
                        <strong>Platform:</strong> ${browserInfo.platform}
                    </div>
                    <div class="test-item">
                        <strong>Viewport:</strong> ${browserInfo.viewport.width}Ã—${browserInfo.viewport.height}<br>
                        <strong>Screen:</strong> ${browserInfo.screen.width}Ã—${browserInfo.screen.height}<br>
                        <strong>Pixel Ratio:</strong> ${browserInfo.viewport.devicePixelRatio}
                    </div>
                    <div class="test-item">
                        <strong>Language:</strong> ${browserInfo.language}<br>
                        <strong>Online:</strong> ${browserInfo.onLine ? 'Yes' : 'No'}<br>
                        <strong>Cookies:</strong> ${browserInfo.cookieEnabled ? 'Enabled' : 'Disabled'}
                    </div>
                </div>
            `;

            window.testResults.browser = { type: browserType, info: browserInfo };
        }

        function getBrowserVersion(userAgent) {
            const match = userAgent.match(/(Chrome|Safari|Firefox|Edg)\/([0-9.]+)/);
            return match ? match[2] : 'Unknown';
        }

        // Feature Detection Tests
        function runInitialTests() {
            const features = [
                { name: 'CSS Grid', test: () => CSS.supports('display', 'grid') },
                { name: 'CSS Flexbox', test: () => CSS.supports('display', 'flex') },
                { name: 'CSS Custom Properties', test: () => CSS.supports('--custom', 'property') },
                { name: 'Touch Events', test: () => 'ontouchstart' in window },
                { name: 'Intersection Observer', test: () => 'IntersectionObserver' in window },
                { name: 'Service Workers', test: () => 'serviceWorker' in navigator },
                { name: 'Web Workers', test: () => typeof Worker !== 'undefined' },
                { name: 'WebSocket', test: () => 'WebSocket' in window },
                { name: 'Geolocation', test: () => 'geolocation' in navigator },
                { name: 'Local Storage', test: () => 'localStorage' in window },
                { name: 'Session Storage', test: () => 'sessionStorage' in window },
                { name: 'WebP Support', test: () => testWebPSupport() }
            ];

            const featureTestsDiv = document.getElementById('feature-tests');
            let featureResults = '';

            features.forEach(feature => {
                const supported = feature.test();
                const status = supported ? 'pass' : 'fail';
                window.testResults.features[feature.name] = supported;
                
                if (supported) window.testResults.overall.passed++;
                else window.testResults.overall.failed++;

                featureResults += `
                    <div class="test-item">
                        <strong>${feature.name}</strong><br>
                        <span class="status ${status}">${supported ? 'Supported' : 'Not Supported'}</span>
                    </div>
                `;
            });

            featureTestsDiv.innerHTML = featureResults;
        }

        function testWebPSupport() {
            const canvas = document.createElement('canvas');
            canvas.width = 1;
            canvas.height = 1;
            return canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;
        }

        // Mobile Viewport Tests
        function testMobileViewport() {
            const select = document.getElementById('device-select');
            const [width, height] = select.value.split(',').map(Number);
            
            const iframe = document.getElementById('app-frame');
            iframe.style.width = width + 'px';
            iframe.style.height = height + 'px';
            iframe.style.border = '2px solid #007bff';
            
            addTestResult('mobile', `Viewport ${width}Ã—${height}`, 'pass', 
                `Successfully resized to ${width}Ã—${height} viewport`);
        }

        function testTouchTargets() {
            // Check if elements meet minimum touch target size (44px)
            const iframe = document.getElementById('app-frame');
            
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const buttons = iframeDoc.querySelectorAll('button, a, input[type="button"], input[type="submit"]');
                
                let passed = 0;
                let failed = 0;
                
                buttons.forEach(btn => {
                    const rect = btn.getBoundingClientRect();
                    const minSize = 44; // iOS minimum
                    
                    if (rect.width >= minSize && rect.height >= minSize) {
                        passed++;
                    } else {
                        failed++;
                    }
                });
                
                const status = failed === 0 ? 'pass' : 'warning';
                addTestResult('mobile', 'Touch Targets', status, 
                    `${passed} passed, ${failed} failed minimum size requirements`);
                    
            } catch (error) {
                addTestResult('mobile', 'Touch Targets', 'fail', 
                    'Could not access iframe content (CORS)');
            }
        }

        // Accessibility Tests
        function testKeyboardNavigation() {
            // Test keyboard navigation features
            const tests = [
                { name: 'Tab Support', test: () => document.querySelector('[tabindex]') !== null },
                { name: 'Focus Visible', test: () => CSS.supports('selector(:focus-visible)') },
                { name: 'Skip Links', test: () => document.querySelector('a[href^="#"]') !== null }
            ];
            
            tests.forEach(test => {
                const result = test.test();
                const status = result ? 'pass' : 'warning';
                addTestResult('accessibility', test.name, status, 
                    result ? 'Feature available' : 'Feature not detected');
            });
        }

        function testColorContrast() {
            // Basic color contrast test
            const elements = document.querySelectorAll('*');
            let contrastIssues = 0;
            
            // This is a simplified test - in production you'd use a proper contrast library
            addTestResult('accessibility', 'Color Contrast', 'pass', 
                'Manual contrast testing required for WCAG 2.1 AA compliance');
        }

        function testScreenReader() {
            // Test screen reader accessibility features
            const tests = [
                { name: 'Alt Text', selector: 'img[alt]' },
                { name: 'ARIA Labels', selector: '[aria-label]' },
                { name: 'ARIA Described By', selector: '[aria-describedby]' },
                { name: 'Heading Structure', selector: 'h1, h2, h3, h4, h5, h6' }
            ];
            
            tests.forEach(test => {
                const elements = document.querySelectorAll(test.selector);
                const status = elements.length > 0 ? 'pass' : 'warning';
                addTestResult('accessibility', test.name, status, 
                    `${elements.length} elements found`);
            });
        }

        // Performance Tests
        function testLoadTime() {
            if (performance.timing) {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                const status = loadTime < 3000 ? 'pass' : loadTime < 5000 ? 'warning' : 'fail';
                
                addTestResult('performance', 'Page Load Time', status, 
                    `${loadTime}ms (target: <3000ms)`);
            } else {
                addTestResult('performance', 'Page Load Time', 'unknown', 
                    'Performance timing not available');
            }
        }

        function testInteractivity() {
            const start = performance.now();
            
            // Test interaction responsiveness
            document.body.click();
            
            requestAnimationFrame(() => {
                const interactionTime = performance.now() - start;
                const status = interactionTime < 100 ? 'pass' : interactionTime < 300 ? 'warning' : 'fail';
                
                addTestResult('performance', 'Interaction Responsiveness', status, 
                    `${Math.round(interactionTime)}ms (target: <100ms)`);
            });
        }

        // Hebrew Text Tests
        function testHebrewRendering() {
            const hebrewDiv = document.querySelector('.hebrew-test');
            const computedStyle = window.getComputedStyle(hebrewDiv);
            
            const tests = [
                { name: 'RTL Direction', test: computedStyle.direction === 'rtl' },
                { name: 'Right Alignment', test: computedStyle.textAlign === 'right' },
                { name: 'Font Support', test: computedStyle.fontFamily.length > 0 }
            ];
            
            tests.forEach(test => {
                const status = test.test ? 'pass' : 'fail';
                addTestResult('hebrew', test.name, status, 
                    test.test ? 'Correctly configured' : 'Configuration issue detected');
            });
        }

        // Application Integration Tests
        function testAppIntegration() {
            const iframe = document.getElementById('app-frame');
            
            // Test if app loads
            iframe.onload = () => {
                addTestResult('integration', 'App Loading', 'pass', 
                    'Application loaded successfully');
            };
            
            iframe.onerror = () => {
                addTestResult('integration', 'App Loading', 'fail', 
                    'Application failed to load');
            };
            
            // Refresh iframe to trigger load test
            iframe.src = iframe.src;
        }

        function toggleMobileView() {
            const iframe = document.getElementById('app-frame');
            const isMobile = iframe.style.width === '375px';
            
            if (isMobile) {
                iframe.style.width = '100%';
                iframe.style.height = '600px';
            } else {
                iframe.style.width = '375px';
                iframe.style.height = '667px';
            }
            
            addTestResult('integration', 'Mobile Toggle', 'pass', 
                `Switched to ${isMobile ? 'desktop' : 'mobile'} view`);
        }

        // Utility Functions
        function addTestResult(category, testName, status, details) {
            if (!window.testResults[category]) {
                window.testResults[category] = {};
            }
            
            window.testResults[category][testName] = { status, details };
            
            // Update overall stats
            if (status === 'pass') window.testResults.overall.passed++;
            else if (status === 'fail') window.testResults.overall.failed++;
            else window.testResults.overall.warnings++;
            
            updateResultsDisplay(category, testName, status, details);
        }

        function updateResultsDisplay(category, testName, status, details) {
            const targetDiv = document.getElementById(`${category}-tests`);
            if (targetDiv) {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'test-item';
                resultDiv.innerHTML = `
                    <strong>${testName}</strong><br>
                    <span class="status ${status}">${status.toUpperCase()}</span><br>
                    <small>${details}</small>
                `;
                targetDiv.appendChild(resultDiv);
            }
            
            updateSummary();
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('results-summary');
            const stats = window.testResults.overall;
            const total = stats.passed + stats.failed + stats.warnings;
            const successRate = total > 0 ? Math.round((stats.passed / total) * 100) : 0;
            
            summaryDiv.innerHTML = `
                <div class="test-grid">
                    <div class="test-item">
                        <strong>Total Tests:</strong> ${total}<br>
                        <strong>Success Rate:</strong> ${successRate}%
                    </div>
                    <div class="test-item">
                        <span class="status pass">Passed: ${stats.passed}</span><br>
                        <span class="status fail">Failed: ${stats.failed}</span><br>
                        <span class="status warning">Warnings: ${stats.warnings}</span>
                    </div>
                </div>
            `;
        }

        function generateReport() {
            const report = {
                timestamp: new Date().toISOString(),
                browser: window.testResults.browser,
                summary: window.testResults.overall,
                results: window.testResults,
                recommendations: generateRecommendations()
            };
            
            console.log('Cross-Platform Validation Report:', report);
            alert('Report generated! Check browser console for details.');
            
            return report;
        }

        function generateRecommendations() {
            const recommendations = [];
            
            // Check for failed tests
            Object.keys(window.testResults).forEach(category => {
                if (typeof window.testResults[category] === 'object' && category !== 'overall' && category !== 'browser') {
                    Object.entries(window.testResults[category]).forEach(([test, result]) => {
                        if (result.status === 'fail') {
                            recommendations.push(`${category}: Fix ${test} - ${result.details}`);
                        }
                    });
                }
            });
            
            if (recommendations.length === 0) {
                recommendations.push('All tests passed! Application is ready for cross-platform deployment.');
            }
            
            return recommendations;
        }

        function exportResults() {
            const report = generateReport();
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cross-platform-test-report-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>